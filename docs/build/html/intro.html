<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml" lang="it">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Introduzione &#8212; do407 0.1.1 documentazione</title>
    
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.1.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/translations.js"></script>
    <link rel="index" title="Indice" href="genindex.html" />
    <link rel="search" title="Cerca" href="search.html" />
    <link rel="next" title="Ansible Installation" href="install.html" />
    <link rel="prev" title="DO407 - Automation With Ansible" href="index.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="introduzione">
<h1>Introduzione<a class="headerlink" href="#introduzione" title="Link a questa intestazione">¶</a></h1>
<p>Il corso <strong>DO407 Automation with Ansible</strong> prepara gli amministratori di sistema ad installare, confifurare e utilizzare Ansible per i processi di automazione e configuration management.</p>
<p>Lo scopo del corso è di mostrare, tramite l’utilizzo di laboratori e esercitazioni guidate, metodi basi e avanzati di creazione e manutenzione di playbook finalizzati alla gestione dei sistemi.</p>
<p>Classroom Environment:</p>
<ul class="simple">
<li><strong>workstation.lab.example.com</strong>    172.125.250.254</li>
<li><strong>servera.lab.example.com</strong>        172.25.250.10</li>
<li><strong>serverb.lab.example.com</strong>        172.25.250.11</li>
<li><strong>tower.lab.example.com</strong>          172.25.250.12</li>
</ul>
<p>Ansible è uno strumento di configuration management, automation e orchestrazione che permette di automtizzare e standardizzare la configurazione di host, vm, container, ecc.</p>
<div class="section" id="architettura">
<h2>Architettura<a class="headerlink" href="#architettura" title="Link a questa intestazione">¶</a></h2>
<p>Una delle principali caratteristiche è l&#8217;infrastruttura agentless che utilizza. Il <strong>control node</strong>, si connette ai <strong>managed hosts</strong> e propaga verso di questi le automazioni e le configurazioni predefinite.
Il control node &#8220;conosce&#8221; i vari hosts grazie a <strong>inventory</strong> che definiscono elenchi di host, eventualmente aggregabili in gruppi, suddivisi ad esenpio per tipologia.</p>
<p>Un inventory può avere un formato simile:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">host1</span>
<span class="n">host2</span>

<span class="mf">192.168</span><span class="o">.</span><span class="mf">10.110</span>
<span class="mf">192.168</span><span class="o">.</span><span class="mf">10.111</span>

<span class="p">[</span><span class="n">dbservers</span><span class="p">]</span>
<span class="n">db</span><span class="o">.</span><span class="n">us</span><span class="o">.</span><span class="n">extraordy</span><span class="o">.</span><span class="n">com</span>
<span class="n">db</span><span class="o">.</span><span class="n">fr</span><span class="o">.</span><span class="n">extrarody</span><span class="o">.</span><span class="n">com</span>
<span class="n">db</span><span class="o">.</span><span class="n">it</span><span class="o">.</span><span class="n">extraordy</span><span class="o">.</span><span class="n">com</span>

<span class="p">[</span><span class="n">webservers</span><span class="p">]</span>
<span class="n">web</span><span class="o">.</span><span class="n">it</span><span class="o">.</span><span class="n">extraordy</span><span class="o">.</span><span class="n">com</span>
<span class="n">web</span><span class="o">.</span><span class="n">de</span><span class="o">.</span><span class="n">extraordy</span><span class="o">.</span><span class="n">com</span>
</pre></div>
</div>
<p>La configurazione di Ansible è gestita, di default tramite il file <cite>/etc/ansible.cfg</cite>. E&#8217; possibile fare override di questo file e utilizzare un cfg alternativo, come si vedrà in seguito. La stessa regola vale per il file inventory.</p>
</div>
<div class="section" id="moduli-e-playbook">
<h2>Moduli e playbook<a class="headerlink" href="#moduli-e-playbook" title="Link a questa intestazione">¶</a></h2>
<p>Tramite ansible è possibile eseguire singoli comandi su uno o più host remoti. Ansible fornisce una serie di <strong>moduli</strong> scritti in Python che vengono installati insieme ai core files. Questi moduli permettono di interagire con diverse funzionalità e servizi dei vari sistemi. Ad esempio, il modulo <strong>yum</strong> permette di gestire pacchetti su sistemi RHEL/CentOS mentre il modulo <strong>shell</strong> permette di eseguire comandi diretti utilizzando un processo bash generato dinamicamente.</p>
<p>Quando è necessario eseguire più moduli in modo strutturato, ad esempio per installare e configurare un servizio, Ansible mette a disposizione i <strong>playbook</strong>. Un playbook è un file in formato YAML in cui si vanno a definire una serie di <strong>task</strong> che richiamano i moduli di cui sopra.</p>
<p>Il seguente playbook di esempio installa il pacchetto httpd e configura il relativo servizio.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">Simple</span> <span class="n">httpd</span> <span class="n">setup</span>
  <span class="n">hosts</span><span class="p">:</span> <span class="nb">all</span>
  <span class="n">remote_user</span><span class="p">:</span> <span class="n">devops</span>
  <span class="n">become</span><span class="p">:</span> <span class="n">true</span>
  <span class="n">tasks</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">Install</span> <span class="n">httpd</span>
      <span class="n">yum</span><span class="p">:</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">httpd</span>
        <span class="n">state</span><span class="p">:</span> <span class="n">latest</span>
    <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">Start</span> <span class="ow">and</span> <span class="n">enable</span> <span class="n">httpd</span> <span class="n">service</span>
      <span class="n">service</span><span class="p">:</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">httpd</span>
        <span class="n">state</span><span class="p">:</span> <span class="n">started</span>
        <span class="n">enabled</span><span class="p">:</span> <span class="n">true</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Avvertimento</p>
<p class="last">Una caratteristica <strong>fondamentale</strong> della sintassi YAML è l&#8217;indentazione. Errori di indentazione causeranno problemi di parsing del playbook. Si consiglia di usare una spaziatura di due o quattro caratteri (no tabs).</p>
</div>
<p>Un control node ansible deve avere installato <strong>Python 2.6</strong> o <strong>2.7</strong>. Il pachetto <strong>ansible</strong> deve essere installato sul control node ma non sui managed hosts.
Ansible si connette ai managed hosts tramite <strong>ssh</strong> e vi trasferisce i moduli che devono essere eseguiti. Ovviamente anche gli host devono avere installato Python, nello specifico dalla versione 2.4 o superiore.</p>
<p>Per consentire la comunicazione tra control node e host tramite ssh è necessario definire disporre di una coppia di chiavi e copiare sugli host la chiave pubblica in modo da permettere un login passwordless.</p>
<p>Ansible permette di eseguire operazioni con i privilegi dell&#8217;utente che si connette remotamente (<strong>devops</strong> nell&#8217;esempio del playbook precedente) oppure di elevarne le credenziali tramite <strong>su</strong> o <strong>sudo</strong> (default sudo, direttiva <cite>become: true</cite>).</p>
<p>Per limitare l&#8217;uso della password durante le operazioni è possibile configurare il file <cite>/etc/sudoers</cite> negli host in modo da consentire l&#8217;esecuzione di comandi senza password.
L&#8217;esempio seguente mostra la direttiva che disattiva l&#8217;inserimento della password per tutti gli utenti del gruppo <strong>devops</strong>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">devops</span> <span class="n">ALL</span><span class="o">=</span><span class="p">(</span><span class="n">ALL</span><span class="p">)</span><span class="n">NOPASSWD</span><span class="p">:</span> <span class="n">ALL</span>
</pre></div>
</div>
</div>
<div class="section" id="modalita-di-connessione">
<h2>Modalità di Connessione<a class="headerlink" href="#modalita-di-connessione" title="Link a questa intestazione">¶</a></h2>
<p>Ansible supporta diverse modalità di connessione. Di default, utilizza il plugin ssh ma sono disponibili diversi altri plugin:</p>
<ul class="simple">
<li><strong>ssh</strong>, basato su OpenSSH. Prevede che sia supportata l&#8217;opzione <strong>ControlPersist</strong>.</li>
<li><strong>local</strong>, per connessioni locali</li>
<li><strong>paramiko</strong>, un&#8217;implementazione di OpenSSH in Python che supporta connessioni persistenti. Usato per comunicare con host RHEL/CentOS 6.</li>
<li><strong>winrm</strong>, plugin per la connessione verso host Windows.</li>
<li><strong>docker</strong>, per container Docker.</li>
<li><strong>jail</strong>, per gestire jail BSD</li>
<li><strong>lxc</strong>, per container lxc</li>
<li><strong>lxd</strong>, per container lxd</li>
</ul>
</div>
<div class="section" id="host-inventory">
<h2>Host Inventory<a class="headerlink" href="#host-inventory" title="Link a questa intestazione">¶</a></h2>
<p>Ansible supporta inventory statici e dinamici. Un inventory statico è un file in formato INI che contiene elenchi di host e gruppi. Un inventory dinamico è un file Python eseguibile che permette di generare dizionari contenenti gruppi dinamici. Inventory statici e dinamici possono essere integrati assieme.</p>
<p>La location di default è il file <cite>/etc/ansible/hosts</cite>. Per eseguire ansible con un altro inventory:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">ansible</span> <span class="p">[</span><span class="o">-</span><span class="n">i</span><span class="o">|--</span><span class="n">inventory</span><span class="p">]</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">inventory</span>
</pre></div>
</div>
<p>Un inventory può definire singoli host o <strong>host group</strong>. Gli host group possono a loro volta essere aggregati in macrogruppi che vengono definiti con il suffisso <strong>children</strong>.</p>
<p>Nell&#8217;esempio seguente i due gruppi <strong>mailservers</strong> e <strong>mailclients</strong> fanno parte di un gruppo <strong>mail</strong></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">localhost</span>
<span class="n">node1</span>

<span class="p">[</span><span class="n">mailservers</span><span class="p">]</span>
<span class="n">node3</span>
<span class="n">node4</span>

<span class="p">[</span><span class="n">mailclients</span><span class="p">]</span>
<span class="n">node5</span>

<span class="p">[</span><span class="n">mail</span><span class="p">:</span><span class="n">children</span><span class="p">]</span>
<span class="n">mailservers</span>
<span class="n">mailclients</span>
</pre></div>
</div>
<p>E&#8217; possibile utilizzare vari tipi di globbing per semplificare la definizione degli host:</p>
<blockquote>
<div><p>Range, nel formato <cite>[START:END]</cite>, utilizzabili sia su indirizzi IP che su hostname:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="mf">10.10</span><span class="o">.</span><span class="mf">1.</span><span class="p">[</span><span class="mi">10</span><span class="p">:</span><span class="mi">20</span><span class="p">]</span>
<span class="n">server</span><span class="p">[</span><span class="mi">10</span><span class="p">:</span><span class="mi">20</span><span class="p">]</span><span class="o">.</span><span class="n">traininglab</span><span class="o">.</span><span class="n">com</span>
</pre></div>
</div>
</div></blockquote>
<p>Gli inventory possono includere <strong>variabili</strong>, sia a livello di host che di gruppo.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">webservers</span><span class="p">]</span>
<span class="n">web1</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span>
<span class="n">web2</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span> <span class="n">http_port</span><span class="o">=</span><span class="mi">8080</span>

<span class="p">[</span><span class="n">webservers</span><span class="p">:</span><span class="nb">vars</span><span class="p">]</span>
<span class="n">http_port</span><span class="p">:</span><span class="mi">80</span>

<span class="p">[</span><span class="n">dbservers</span><span class="p">]</span>
<span class="n">web1</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span>
<span class="n">db1</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span>
</pre></div>
</div>
<p>In questo esempio la variabile http_port è definita a livello host per web2.example.com e a livello group per webservers. Il valora a livello host farà override sul valore a livello group.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Tabella dei contenuti</a></h3>
  <ul>
<li><a class="reference internal" href="#">Introduzione</a><ul>
<li><a class="reference internal" href="#architettura">Architettura</a></li>
<li><a class="reference internal" href="#moduli-e-playbook">Moduli e playbook</a></li>
<li><a class="reference internal" href="#modalita-di-connessione">Modalità di Connessione</a></li>
<li><a class="reference internal" href="#host-inventory">Host Inventory</a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="index.html" title="capitolo precedente">DO407 - Automation With Ansible</a></li>
      <li>Next: <a href="install.html" title="capitolo successivo">Ansible Installation</a></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>Questa pagina</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/intro.rst.txt"
            rel="nofollow">Mostra sorgente</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Ricerca veloce</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Vai" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016, Gianni Salinetti.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.5.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.9</a>
      
      |
      <a href="_sources/intro.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>